@*
    Displays a Folder's Notes.html fils and all the songs
*@
@model DirMgr.FileSet
@{
    ViewBag.Title = "Song";
    Layout = "~/Views/Shared/_LayoutMinimal.cshtml";
}
<div class="danSongAlbum">
    <div class="danNotes">@Html.Raw(Model.Notes)</div>
    <div class="danDiv">
        @{
            var useTitle = !string.IsNullOrWhiteSpace(Model.AudioFileInfo.Title) ? Model.AudioFileInfo.Title
                        : Model.AudioFileName.Substring(Model.AudioFileName.LastIndexOf("\\") + 1);
            Html.RenderPartial("_Song", new SongViewModel(0, Model.AudioFileName, useTitle, Model.Notes, Model.SecondsDuration));
        }
    </div>
</div>
<audio id="audioPlayer" src="">
    Your browser does not support the audio format.
</audio>
@section Scripts
{
    <script type="text/javascript">
        let audioMgr = new DanAudioMgr("audioPlayer", ".danSongAlbum",
            function (triggerElem, eventName, currSecs) {
                var $t = $(triggerElem);
                var $p = $t.closest(".danSong");
                var $title = $p.find(".danTitle");
                var $prog = $p.find(".danProgress");
                var $bar = $p.find(".danProgressBar");
                if (eventName == "onplay") {
                    $(".danPlayPauseButtonActive").removeClass("danPlayPauseButtonActive")
                    //$(".danProgress").css("display", "none")
                    $title.addClass("danPlayPauseButtonActive")

                    $bar.width = 0;
                    $prog.addClass("danProgressShow")
                }
                else if (eventName == "onstop" || eventName == "onended") {
                    $title.removeClass("danPlayPauseButtonActive")
                    $prog.removeClass("danProgressShow").addClass("danProgressHide")
                }
                else if (eventName == "ontimeupdate") {
                    var totSecs = $t.data("secsdur")
                    $bar.css("width", (Math.round((currSecs / totSecs) * 100)) + "%")
                }
            });
        var first = true;
        $(".danPlayPauseButton").click(function () {
            //alert("Click!")
            if (first) {
                $(".danPrevMediaButton,.danNextMediaButton").removeClass("danScaleOut")
                $(".danPrevMediaButton,.danNextMediaButton").addClass("danScaleIn")
            }
            else {
                $(".danPrevMediaButton,.danNextMediaButton").removeClass("danScaleIn")
                $(".danPrevMediaButton,.danNextMediaButton").addClass("danScaleOut")
            }
            first = !first;
        })
    </script>
}
